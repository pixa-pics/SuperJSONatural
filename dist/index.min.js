"use strict";var SuperJSONatural=function e(t){if(!(this instanceof e))return new e;this.chunck_size_=0|t||4096,this.packed_head_=new Uint8Array(this.chunck_size_),this.packed_body_=new Uint8Array(this.chunck_size_)};Object.defineProperty(SuperJSONatural.prototype,"chunck_size",{get:function(){return this.chunck_size_}}),Object.defineProperty(SuperJSONatural.prototype,"packed_head",{get:function(){return this.packed_head_},set:function(e){this.packed_head_=e}}),Object.defineProperty(SuperJSONatural.prototype,"packed_body",{get:function(){return this.packed_body_},set:function(e){this.packed_body_=e}});var base64abcCC=Uint8Array.of(65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47);SuperJSONatural.prototype.bytesToBase64=function(e){var t=2,r=0,a=0|e.length,n=a%3,i=(Math.floor(a/3),4*Math.ceil(a/3)),o=new Uint8Array(i);for(t=2,r=0;(0|t)<(0|a);t=(t+3|0)>>>0,r=(r+4|0)>>>0)o[r]=255&base64abcCC[e[t-2|0]>>2],o[r+1|0]=255&base64abcCC[(3&e[t-2|0])<<4|e[t-1|0]>>4],o[r+2|0]=255&base64abcCC[(15&e[t-1|0])<<2|e[t]>>6],o[r+3|0]=255&base64abcCC[63&e[t]];(0|t)==(a+1|0)&&(o[r]=255&base64abcCC[e[t-2|0]>>2],o[r+1|0]=255&base64abcCC[(3&e[t-2|0])<<4],o[r+2|0]=255&"=".charCodeAt(0),o[r+3|0]=255&"=".charCodeAt(0),r=(r+4|0)>>>0),(0|t)==(0|a)&&(o[r]=255&base64abcCC[e[t-2|0]>>2],o[r+1|0]=255&base64abcCC[(3&e[t-2|0])<<4|e[t-1|0]>>4],o[r+2|0]=255&base64abcCC[(15&e[t-1|0])<<2],o[r+3|0]=255&"=".charCodeAt(0),r=(r+4|0)>>>0);var u="";for(t=0;t<o.length;t=(t+1024|0)>>>0)u=u.concat(String.fromCharCode.apply(null,o.subarray(t,Math.min(t+1024|0,o.length))));return u};var base64error_code=255,base64codes=Uint8Array.of(255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51),base64codes_length=0|base64codes.length;function charCodeAt(e){return 255&e.charCodeAt(0)}function getBase64CodesBufferResults(e){return Uint8Array.of(e>>16,e>>8&255,255&e)}function getBase64CodesBufferResultsBy4(e,t,r,a){return Uint8Array.of(e>>16,e>>8&255,255&e,t>>16,t>>8&255,255&t,r>>16,r>>8&255,255&r,a>>16,a>>8&255,255&a)}function getBase64Code(e){return 255&(0|base64codes[e=255&(0|e)])}function getBase64CodesBuffer(e){return(getBase64Code(e[0])<<18|getBase64Code(e[1])<<12|getBase64Code(e[2])<<6|getBase64Code(e[3])|0)>>>0}SuperJSONatural.prototype.base64ToBytes=function(e,t,r){t|=0;var a=new Uint8Array(e.length-t|0),n=a.length,i=0,o=0;for(i=0,o=t;(i+7|0)<(0|n);i=(i+8|0)>>>0,o=(o+8|0)>>>0)a[0|i]=255&e.charCodeAt(0|o),a[i+1|0]=255&e.charCodeAt(o+1|0),a[i+2|0]=255&e.charCodeAt(o+2|0),a[i+3|0]=255&e.charCodeAt(o+3|0),a[i+4|0]=255&e.charCodeAt(o+4|0),a[i+5|0]=255&e.charCodeAt(o+5|0),a[i+6|0]=255&e.charCodeAt(o+6|0),a[i+7|0]=255&e.charCodeAt(o+7|0);for(;(0|i)<(0|n);i=(i+1|0)>>>0,o=(o+1|0)>>>0)a[0|i]=255&e.charCodeAt(0|o);var u=e.endsWith("==")?2:e.endsWith("=")?1:0,s=e.length-t|0,f=new Uint8Array(s/4*3),d=new Uint8Array(16);for(i=0,o=0;(i+16|0)<(0|s);i=(i+16|0)>>>0,o=(o+12|0)>>>0)d=a.slice(0|i,i+16|0),f.set(getBase64CodesBufferResultsBy4(getBase64CodesBuffer(d.subarray(0,4)),getBase64CodesBuffer(d.subarray(4,8)),getBase64CodesBuffer(d.subarray(8,12)),getBase64CodesBuffer(d.subarray(12,16))),o);for(;(0|i)<(0|s);i=(i+4|0)>>>0,o=(o+3|0)>>>0)f.set(getBase64CodesBufferResults(getBase64CodesBuffer(a.slice(0|i,i+4|0))),o);return new r(f.buffer.slice(0,f.length-u))},SuperJSONatural.TYPES=[{id:0,name:"undefined",fixed:!0,bytes:0,header:0,typeof:"undefined",instanceof:void 0},{id:1,name:"null",fixed:!0,bytes:0,header:0,typeof:"object",instanceof:void 0},{name:"NaN",id:2,fixed:!0,bytes:0,header:0,typeof:"number",instanceof:Object},{name:"Infinity",id:3,fixed:!0,bytes:0,header:0,typeof:"number",instanceof:void 0},{name:"Boolean",id:4,fixed:!0,bytes:1,header:0,typeof:"boolean",instanceof:void 0},{name:"Int32",id:5,fixed:!0,bytes:4,header:0,typeof:"number",instanceof:void 0},{name:"Uint32",id:6,fixed:!0,bytes:4,header:0,typeof:"number",instanceof:void 0},{name:"Float32",id:7,fixed:!0,bytes:4,header:0,typeof:"number",instanceof:void 0},{name:"BigInt64",id:8,fixed:!0,bytes:8,header:0,typeof:"number",instanceof:void 0},{name:"Float64",id:9,fixed:!0,bytes:4,header:0,typeof:"number",instanceof:void 0},{name:"String",id:10,fixed:!1,bytes:0,header:2,typeof:"string",instanceof:""},{name:"ArrayBuffer",id:11,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:ArrayBuffer},{name:"Int8Array",id:12,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:Int8Array},{name:"Uint8Array",id:13,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:Uint8Array},{name:"Uint8ClampedArray",id:14,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:Uint8ClampedArray},{name:"Int16Array",id:15,fixed:!1,lbytes:2,bytes:0,header:2,typeof:"object",instanceof:Int16Array},{name:"Uint16Array",id:16,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:Uint16Array},{name:"Int32Array",id:17,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:Int32Array},{name:"Uint32Array",id:18,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:Uint32Array},{name:"Float32Array",id:19,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:Float32Array},{name:"Float64Array",id:20,fixed:!1,lbytes:2,bytes:0,header:2,typeof:"object",instanceof:Float64Array},{name:"BigInt64Array",id:21,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:BigInt64Array},{name:"BigUint64Array",id:22,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:BigUint64Array},{name:"Array",id:23,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:Array},{name:"Object",id:24,fixed:!1,bytes:0,header:2,typeof:"object",instanceof:""}],SuperJSONatural.textEncoder=new TextEncoder,SuperJSONatural.textDecoder=new TextDecoder,SuperJSONatural.encodeString=function(e){return SuperJSONatural.textEncoder.encode(e)},SuperJSONatural.decodeBuffer=function(e){return SuperJSONatural.textDecoder.decode(e)},SuperJSONatural.prototype.getTypeFromData=function(e){switch(typeof e){case"object":if(null==e)return SuperJSONatural.TYPES[1];if(e instanceof ArrayBuffer)return SuperJSONatural.TYPES[11];if("buffer"in e){if(e.buffer instanceof ArrayBuffer){for(var t=12;t<=22;t++)if(e instanceof SuperJSONatural.TYPES[t].instanceof)return SuperJSONatural.TYPES[t];return SuperJSONatural.TYPES[24]}return SuperJSONatural.TYPES[24]}return e instanceof Array?SuperJSONatural.TYPES[23]:SuperJSONatural.TYPES[24];case"number":return e==1/0?SuperJSONatural.TYPES[3]:NaN==e?SuperJSONatural.TYPES[2]:e!==(0|e)?SuperJSONatural.TYPES[7]:(e|=0)<0?e<-2147483648?SuperJSONatural.TYPES[8]:SuperJSONatural.TYPES[5]:e<=4294967295?SuperJSONatural.TYPES[6]:SuperJSONatural.TYPES[8];case"string":return SuperJSONatural.TYPES[10];case"undefined":default:return SuperJSONatural.TYPES[0];case"bigint":return SuperJSONatural.TYPES[8];case"boolean":return SuperJSONatural.TYPES[4]}},SuperJSONatural.prototype.stringify=function(e){var t=this.bytesToBase64,r=this.getTypeFromData;function a(e){return r(e)}return JSON.stringify(function e(r){var n,i=a(r);return(0|i.id)<=22&&(0|i.id)>=12?r="$TA_"+i.id+"_B64$"+(n=r.buffer,t(new Uint8Array(n))):23==(0|i.id)?r.forEach((function(t,n){var i=a(t).id;(0|i)>=12&&(0|i)<=24&&(r[n]=e(t))})):24==(0|i.id)&&Object.entries(r).forEach((function(t){var n=a(t[1]).id;(0|n)>=12&&(0|n)<=24&&(r[t[0]]=e(t[1]))})),r}(e))},SuperJSONatural.prototype.parse=function(e){var t=this.base64ToBytes,r=this.getTypeFromData,a=SuperJSONatural.TYPES;function n(e,r,a){return t(e,r,a)}function i(e){return r(e)}return function e(t){var r=i(t);if(10==(0|r.id)){if(t.startsWith("$TA_")){var o=parseInt(t.charAt(4)+t.charAt(5),10);t=n(t,11,a[o].instanceof)}}else 23==(0|r.id)?t.forEach((function(r,a){t[a]=e(r)})):24==(0|r.id)&&Object.entries(t).forEach((function(r){t[r[0]]=e(r[1])}));return t}(JSON.parse(e),SuperJSONatural.TYPES)},SuperJSONatural.prototype.pack=function(e){this.bytesToBase64;var t,r=0,a=this.packed_body,n=this.getTypeFromData;function i(e){return n(e)}t=function e(t){var n=i(t);return(0|n.id)<=22&&(0|n.id)>=12?t="$TA_"+n.id+"_PA&"+function(e){var t=new Uint8Array(e);if(a.length-r<t.length){var n=new Uint8Array(a.length+Math.max(this.chunck_size,t.length));n.set(a,0),a=n}var i=r,o=r+t.length;return a.set(t,i),r=o,"F="+i+"T="+o+"$"}(t.buffer):23==(0|n.id)?t.forEach((function(r,a){var n=i(r).id;(10==n||n<=24&&function(){return 12})&&(t[0|a]=e(r))})):24==(0|n.id)&&Object.entries(t).forEach((function(r){var a=i(r[1]).id;(10==a||a<=24&&function(){return 12})&&(t[r[0]]=e(r[1]))})),t}(e);var o=JSON.stringify(t),u=2*o.length+5,s=new Uint8Array(0);this.packed_head.length<u&&(this.packed_head=new Uint8Array(u));var f=SuperJSONatural.textEncoder.encodeInto(o,this.packed_head),d={read:0,written:0};o.length>f.read&&(s=new Uint8Array(3*(o.length-f.read)),d=SuperJSONatural.textEncoder.encodeInto(o.slice(f.read,o.length),s));var c,y=new Uint8Array(0),p=0;0===d.written?p=(c=this.packed_head.subarray(0,f.written)).length:(c=this.packed_head.subarray(0,f.written),y=s.subarray(0,d.written),p=c.length+y.length);var h=new Uint8Array(2+p+r);return h[0]=p>>0&255,h[1]=p>>8&255,h.set(c,2),y.length>0&&h.set(y,c.length+2),h.set(a.subarray(0,r),2+p),this.packed_body=a,h},SuperJSONatural.prototype.unpack=function(e){var t=this.getTypeFromData,r=SuperJSONatural.TYPES,a=(0|e[0]<<0|e[1]<<8)+2|0,n=JSON.parse(SuperJSONatural.decodeBuffer(e.subarray(2,a)));this.base64ToBytes;function i(e){return t(e)}return function t(n){switch(i(n).id){case 10:if(n.startsWith("$TA_")){var o=parseInt(n.charAt(4)+n.charAt(5)),u=(n=n.slice(12,n.length-1)).split("T="),s=parseInt(u[0]),f=parseInt(u[1]);n=function(t,r,n){return new n(e.slice(a+t,a+r).buffer)}(s,f,r[o].instanceof)}break;case 23:n.forEach((function(e,r){var a=i(e).id;10!=(0|a)&&23!=(0|a)&&24!=(0|a)||(n[0|r]=t(e))}));break;case 24:Object.entries(n).forEach((function(e){var r=i(e[1]).id;10!=(0|r)&&23!=(0|r)&&24!=(0|r)||(n[e[0]]=t(e[1]))}))}return n}(n)},"undefined"!=typeof module?module.exports=SuperJSONatural:window.SuperJSONatural=SuperJSONatural;
